# Base Workflow Template
# 
# This template provides the common structure shared by all workflow specs.
# New specs can reference this as a foundation and override specific sections.
#
# Usage: Copy this file and customise the [workflow], [phases], and prompt sections.

# =============================================================================
# METADATA
# =============================================================================

[meta]
version = "1.0.0"
schema = "lia-workflow-spec/v1"
# Override these in your spec:
# name = "your-workflow-name"
# category = "development|quality|problem-solving|research|knowledge|strategy"
# tags = ["tag1", "tag2"]

# =============================================================================
# CONFIGURATION
# =============================================================================

[config]
# Output directory pattern - use {task_name} as placeholder
output_dir = ".lia/{workflow_type}/{task_name}"

# Required tools (for documentation purposes)
requires_tools = ["file_write", "user_input"]

# Resumability support
resumable = true
checkpoint_interval = "per_phase"

# =============================================================================
# WORKFLOW MODE SYSTEM (Common to all workflows)
# =============================================================================
# 
# All workflows support two distinct modes:
#
# **Collaboration Mode** (Default)
# - Stepwise execution with user approval at each stage
# - Interactive feedback and iterative refinement
# - User control over workflow progression
# - Collaborative decision-making throughout the process
#
# **Silent Mode** (User-Triggered Only)
# - Continuous autonomous execution without user interruption
# - Complete workflow execution from start to finish
# - Assumption-based progression when user input would normally be required
# - All assumptions MUST be recorded in the 0-notepad.md file
# - No user approval requests during workflow execution
#
# Mode Selection: The workflow defaults to Collaboration Mode. 
# Silent Mode must be explicitly requested by the user.

# =============================================================================
# COMMON EXECUTION INSTRUCTIONS
# =============================================================================
#
# These instructions apply to ALL workflows:
#
# - When you want the user to review a document, you MUST use the 'userInput' 
#   tool to ask the user a question
# - You MUST have the user review each phase document before proceeding to the next
# - After each phase completion or revision, you MUST explicitly ask the user 
#   to approve the work using the 'userInput' tool
# - You MUST NOT proceed to the next phase until you receive explicit approval 
#   from the user (a clear "yes", "approved", or equivalent affirmative response)
# - If the user provides feedback, you MUST make the requested modifications 
#   and then explicitly ask for approval again
# - You MUST continue this feedback-revision cycle until the user explicitly 
#   approves the work
# - You MUST follow the workflow steps in sequential order
# - You MUST NOT skip ahead to later steps without completing earlier ones 
#   and receiving explicit user approval
# - You MUST treat each constraint in the workflow as a strict requirement
# - You MUST NOT assume user preferences or requirements - always ask explicitly
# - You MUST maintain a clear record of which step you are currently on
# - You MUST NOT combine multiple steps into a single interaction
# - You MUST ONLY execute one task at a time. Once it is complete, do not move 
#   to the next task automatically

# =============================================================================
# NOTEPAD TEMPLATE
# =============================================================================
#
# Every workflow creates a 0-notepad.md file using this structure:
#
# ```markdown
# # {Workflow Name} Notepad
# **Workflow**: {Workflow Type}  
# **Task**: {task_name}  
# **Created**: {date}
#
# ---
#
# ## KEY INSIGHTS & DISCOVERIES
# <!-- Unexpected findings, patterns, or "aha moments" -->
#
# ## TECHNICAL NOTES & IMPLEMENTATION DETAILS  
# <!-- Technical considerations, constraints, implementation details -->
#
# ## IDEAS & FUTURE ENHANCEMENTS
# <!-- Ideas, improvements, enhancement opportunities -->
#
# ## CROSS-SYSTEM CONNECTIONS
# <!-- Links to other components, related work, architectural insights -->
#
# ## USER NOTES
# <!-- Space for user to add their own observations -->
#
# ## LLM OBSERVATIONS
# <!-- AI-generated insights about patterns and strategies -->
#
# ---
# *This notepad captures valuable insights that emerge during systematic analysis*
# ```

# =============================================================================
# CONTEXT HANDOFF TEMPLATE
# =============================================================================
#
# Use this template when handing off to another session, spec, or reviewer.
# Save as `handoff.md` in the task directory.
#
# ```markdown
# # Context Handoff Summary
# **From**: {current_workflow} | **To**: {next_workflow or "New Session"}
# **Task**: {task_name}
# **Date**: {date}
#
# ---
#
# ## Task State
# - **Started**: {start_datetime}
# - **Current Phase**: {phase_number} of {total_phases} ({phase_name})
# - **Completion**: ~{percentage}%
# - **Status**: {In Progress | Blocked | Ready for Review | Complete}
#
# ## Key Decisions Made
# 1. {Decision 1 with brief rationale}
# 2. {Decision 2 with brief rationale}
# 3. ...
#
# ## Open Questions / Blockers
# - [ ] {Question or blocker 1}
# - [ ] {Question or blocker 2}
#
# ## Files Modified/Created
# | File | Status | Notes |
# |------|--------|-------|
# | `path/to/file` | New/Modified | Brief description |
#
# ## Next Actions
# 1. {Immediate next step}
# 2. {Following step}
# 3. {Following step}
#
# ## Handoff Type
# - [ ] Continue in new session (same workflow)
# - [ ] Transition to different workflow: `{workflow_name}`
# - [ ] Human review required
# - [ ] Complete - archive context
#
# ## Notes for Next Session
# {Any important context, gotchas, or recommendations}
# ```

# =============================================================================
# SCOPE GUARD (Prevent Over-Engineering)
# =============================================================================
#
# Before implementing any solution, apply the scope check:
#
# ```markdown
# ### Scope Check
# Before proceeding with implementation:
# - [ ] This is the simplest solution that meets requirements
# - [ ] No unnecessary abstractions or indirection
# - [ ] No premature optimisation
# - [ ] No speculative features ("might need later")
# - [ ] A developer new to the project could understand this
#
# **Complexity Assessment**: [GREEN] Minimal | [YELLOW] Reasonable | [RED] Over-engineered
#
# **If [RED] Over-engineered**:
# 1. Document what could be simplified
# 2. Simplify before proceeding
# 3. Record removed complexity in notepad
# ```
#
# Apply scope checks:
# - Before starting implementation phases
# - When adding new abstractions or patterns
# - When solution exceeds original estimate by >50%

# =============================================================================
# SELF-CORRECTION LOOP
# =============================================================================
#
# After each phase output, verify before proceeding:
#
# ```markdown
# ### Verification Checkpoint
# Before moving to next phase:
# - [ ] Output meets stated requirements
# - [ ] No errors or warnings introduced  
# - [ ] Assumptions documented in notepad
# - [ ] Scope check passed
#
# **If verification fails** (max 3 attempts):
# 1. Document the failure reason
# 2. Analyse root cause
# 3. Adjust approach and retry
# 4. After 3 failures → escalate to user
# ```

# =============================================================================
# CONFIDENCE SIGNALS
# =============================================================================
#
# At key decision points, indicate confidence level:
#
# ```markdown
# ### Confidence Assessment
# **Decision confidence**: [HIGH] | [MEDIUM] | [LOW]
#
# [HIGH]: Clear requirements, proven pattern, minimal uncertainty
# [MEDIUM]: Some assumptions made, edge cases possible, may need revision
# [LOW]: Significant uncertainty, multiple valid approaches, user review needed
#
# **If [LOW]**: Pause and list uncertainties for user review before proceeding.
# ```

# =============================================================================
# ABORT CONDITIONS
# =============================================================================
#
# Immediately stop and consult the user if:
# - [ABORT] Circular logic or infinite loop detected
# - [ABORT] 3+ consecutive failed correction attempts  
# - [ABORT] Scope has grown >50% beyond original estimate
# - [ABORT] Security or data safety concern identified
# - [ABORT] Missing critical information after 2 clarification attempts
# - [ABORT] Conflicting requirements that cannot be resolved
# - [ABORT] Task requires capabilities not available

# =============================================================================
# CHECKPOINT MARKERS
# =============================================================================
#
# Use checkpoint markers to enable workflow resumption:
#
# At the end of each phase, record:
# ```markdown
# ---
# [CHECKPOINT: Phase {N} Complete]
# Time: {timestamp}
# Artifacts: {list of files created}
# Next: Phase {N+1} - {phase_name}
# ---
# ```
#
# To resume a workflow:
# 1. Read the notepad and any handoff.md
# 2. Find the last [CHECKPOINT] marker
# 3. Verify artifacts from that checkpoint exist
# 4. Continue from the indicated next phase

# =============================================================================
# CONTEXT VERIFICATION MARKERS
# =============================================================================
#
# Use markers at the start of phase responses to detect context rot:
#
# ```markdown
# LIA-{WORKFLOW}-{N} Starting Phase {N}: {Phase Name}...
# ```
#
# If the marker disappears from responses, context has been lost.
# Reload the spec or summarise current state to restore context.
#
# Markers by workflow:
# - DEV: LIA-DEV-{N}
# - SPEC: LIA-SPEC-{N}
# - TEST: LIA-TEST-{N}
# - REVIEW: LIA-REVIEW-{N}
# - (etc.)

# =============================================================================
# PROOF ARTIFACTS
# =============================================================================
#
# Create proof artifacts BEFORE committing. Evidence-driven development:
#
# ```markdown
# # Proof Artifact: {Task ID}
# **Created**: {timestamp}
# **Phase**: {phase_number} - {phase_name}
#
# ## Acceptance Criteria Met
# - [x] Criterion 1: {evidence - test output, screenshot, or verification}
# - [x] Criterion 2: {evidence}
# - [ ] Criterion 3: {not yet verified - reason}
#
# ## Tests Passing
# ```
# {test output or CI status}
# ```
#
# ## No Regressions
# - [ ] Existing tests still pass
# - [ ] No new warnings introduced
# - [ ] Performance not degraded
#
# ## Security Checklist
# - [ ] No hardcoded secrets
# - [ ] Input validation present
# - [ ] Auth/authz checked (if applicable)
#
# ## Reviewer Notes
# {Any context for human review}
# ```
#
# Store proof artifacts in: `.lia/{workflow}/{task_name}/proofs/`

# =============================================================================
# DOCUMENT LOCATIONS (Portable paths)
# =============================================================================
#
# Before executing tasks, ensure you have read relevant documents from:
# - ${WORKSPACE}/docs/ or ./docs/ (main documentation folder)
# - ${WORKSPACE}/docs/development/blueprint-1/phase-1/new-implementations/ (recent implementations)
# - Any existing .lia/{workflow}/{task_name}/*.md files for the current task

# =============================================================================
# ALTERNATIVE REASONING BACKUPS (From Spec_Engine Article VII)
# =============================================================================
#
# Valid backups are ALTERNATIVE REASONING PATHS, not retries:
#
# VALID backup examples:
# - "If documentation incomplete, inspect source code directly"
# - "If unit tests insufficient, try integration testing approach"
# - "If automated analysis fails, apply manual heuristics"
# - "If primary API unavailable, use alternative data source"
#
# INVALID backup examples:
# - "Try again" (NOT a valid backup)
# - "Retry with same approach" (NOT a valid backup)
# - "Run the same command again" (NOT a valid backup)
#
# When primary approach fails:
# 1. Document WHY it failed (not just that it failed)
# 2. Identify genuinely DIFFERENT approach
# 3. Apply alternative reasoning path
# 4. If no genuine alternatives exist, escalate to user
#
# The goal is to approach the problem from a different angle,
# not to repeat the same action hoping for different results.

# =============================================================================
# ERROR PROPAGATION STRATEGIES (From Spec_Engine Article VIII)
# =============================================================================
#
# At workflow start, select one of three strategies:
#
# ```markdown
# ### Error Propagation Strategy
# **Selected**: {strategy_name}
#
# **Options**:
# 1. **halt_on_critical** (Production/Security)
#    - Stop immediately on critical failure
#    - No downstream steps execute
#    - Use when: Deployments, security-sensitive work, data migrations
#
# 2. **continue_and_log** (Exploration/Research)
#    - Log failure as warning, continue to next step
#    - Accumulate failures for review at end
#    - Use when: Research, prototyping, learning exercises
#
# 3. **collaborative_review** (Recommended Default)
#    - Pause and request human decision at each failure
#    - User decides: continue, retry, or abort
#    - Use when: Complex decisions, uncertain outcomes
# ```
#
# Document chosen strategy in notepad at workflow start.
# If no strategy selected, default to collaborative_review.

# =============================================================================
# VERIFICATION BEFORE STATUS (From Spec_Engine Weakness Analysis)
# =============================================================================
#
# Before marking ANY item "Fixed", "Complete", or "Done":
#
# ```markdown
# ### Verification Checkpoint
# **Claimed Status**: {Fixed/Complete/Done}
# **Item**: {what is being marked complete}
#
# **Verification Evidence**:
# - [ ] Automated tests pass (if applicable)
# - [ ] Manual verification performed
# - [ ] Evidence captured (screenshot, output, or test result)
# - [ ] No new warnings or errors introduced
# - [ ] Regression check completed
#
# **Evidence Location**: {Link to proof artifact or inline evidence}
#
# **Verification Method**: {How was this verified?}
# ```
#
# CRITICAL DISTINCTION:
# - Status based on OUTCOME, not INTENT
# - "I wrote the fix" ≠ "It's fixed"
# - "I tested and verified it works" = "It's fixed"
#
# Never claim completion without evidence.

# =============================================================================
# CRITICALITY BALANCE GUIDANCE (From Spec_Engine Article VI)
# =============================================================================
#
# When marking steps as critical vs non-critical in task breakdowns:
#
# **Target Distribution**: 40-60% of steps should be critical
#
# | Range | Meaning | Risk |
# |-------|---------|------|
# | <20% critical | Under-critical | Failures accumulate silently; goal may be unachievable |
# | 40-60% critical | Balanced | Appropriate escalation without workflow paralysis |
# | >80% critical | Over-critical | Everything escalates; workflow grinds to halt |
#
# **Exceptions**:
# - Production deployments: 70%+ critical may be appropriate
# - Research/exploration: 20-30% critical may be appropriate
# - Security-sensitive: 80%+ critical is justified
#
# **Requirement**: Document criticality rationale for each critical step.
#
# ```markdown
# ### Criticality Assessment
# - Total steps: {N}
# - Critical steps: {M} ({percentage}%)
# - Balance: [GREEN] Appropriate | [YELLOW] Review needed | [RED] Rebalance required
#
# **Critical step rationale**:
# - Step X: Critical because {reason}
# - Step Y: Critical because {reason}
# ```

# =============================================================================
# TROUBLESHOOTING ESCALATION (From Spec_Engine "Troubleshooting Cliff")
# =============================================================================
#
# If implementation or fix attempts fail after 3 attempts:
#
# 1. **STOP** ad-hoc debugging immediately
# 2. **DOCUMENT** all prior attempts in notepad:
#    - What was tried
#    - Why it failed
#    - What was learned
# 3. **SWITCH** to structured troubleshooting:
#    - `troubleshoot.toml` - General systematic debugging
#    - `wtf.toml` - Mysterious behaviour / feature archaeology
#    - `investigate.toml` - Root cause analysis / forensics
# 4. **FOLLOW** troubleshooting phases systematically
# 5. **RETURN** to original workflow only after resolution
#
# **Anti-pattern**: Circular debugging without structured approach
#
# ```markdown
# ### Troubleshooting Escalation
# **Trigger**: 3 failed attempts at {task}
# **Prior attempts documented**: Yes/No
# **Escalating to**: troubleshoot.toml / wtf.toml / investigate.toml
# **Reason**: {why this troubleshooting spec fits}
# ```
#
# Evidence: Spec_Engine's "Troubleshooting Cliff" showed 100% creation success
# followed by systemic debugging failure. Structured troubleshooting prevents this.

# =============================================================================
# PRE-FLIGHT VALIDATION (Optional - From Spec_Engine Article IV, Simplified)
# =============================================================================
#
# Before starting workflow execution (optional but recommended):
#
# ```markdown
# ### Pre-Flight Check
# - [ ] Objective clearly stated
# - [ ] Required context available (codebase, docs, dependencies)
# - [ ] Output location confirmed (.lia/{workflow}/{task}/)
# - [ ] Error propagation strategy selected
# - [ ] Time estimate acknowledged
#
# **Ready to proceed**: Yes / No (specify blocker)
# ```
#
# Skip pre-flight with explicit user request: "proceed without validation"
#
# This is a 5-item check, not a 10-step validation. Keep it lightweight.

# =============================================================================
# AGENT MINDSET (Common qualities)
# =============================================================================
#
# As you execute any workflow, embody these qualities:
#
# **Resilience and Adaptability:**
# - Maintain composure when faced with complex or ambiguous problems
# - If initial approaches fail, adapt your strategy and try alternatives
# - View setbacks as learning opportunities
#
# **Comfort in Ambiguity:**
# - Work confidently with incomplete or conflicting information
# - Make reasonable assumptions when necessary and validate them systematically
# - Navigate unclear situations by focusing on what can be determined
#
# **Self-Reliance and Critical Thinking:**
# - Trust your analytical capabilities and systematic approach
# - Make independent decisions based on evidence and logical reasoning
# - Question assumptions and validate information
#
# **Growth Mindset:**
# - Approach each session as an opportunity to enhance skills
# - Learn from every interaction and incorporate new knowledge
# - Maintain curiosity and openness to discovering unexpected solutions
